{"_id":"note:MGA78xnaE","title":"PSQL","content":"GET Last_Activity\n```\nselect id,email,charge,to_char( now()-stamp, 'DD☀\" \" HH24\"°\" MI\"´ \"' ) as LAST_ACTIVITY from users order by LAST_ACTIVITY;\n```\n```\nselect id,email,charge,to_char( now()-stamp, 'DD☀️\" \" HH24\"°\" MI\"´ \"' ) as LAST_ACTIVITY from users order by LAST_ACTIVITY;\n```\n\n<hr>\n\nCreate Table\n```\nCREATE TABLE users (\n    id             SERIAL  PRIMARY KEY             ,\n    email           TEXT    NOT NULL    UNIQUE      ,\n    devices         json    NOT NULL                ,\n    charge          INTEGER NOT NULL    DEFAULT 5   ,\n    purchased_items json    NOT NULL\n);\n```\n\n<hr>\n\nInsert Data\n```\nINSERT INTO users ( email, devices )\nVALUES ( 'unifino@protonmail.com', '{ \"0\": { \"name\": \"Xioami\", \"code\": \"XXX\" } }' )\nRETURNING *;\n```\n\n<hr>\n\nCreate | Replace Function\n```\nCREATE OR REPLACE FUNCTION trigger_set_timestamp()\nRETURNS TRIGGER AS $$\nBEGIN\n  NEW.stamp = NOW();\n  RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n```\n\n<hr>\n\nAssign Function (Create Trigger)\n```\nCREATE TRIGGER set_timestamp\nBEFORE UPDATE ON users\nFOR EACH ROW\nEXECUTE PROCEDURE trigger_set_timestamp();\n```\n\n<hr>\n\nReset ID ! CAUTION !\n```\nUPDATE users SET id=1000000+nextval('users_id_seq');\nALTER SEQUENCE users_id_seq RESTART;\nUPDATE users SET id = DEFAULT;\n```\n\n<hr>\n\nUpdate Table: \n\n```\nUPDATE users \nSET devices = '[{\"name\":\"Xiaomi | Redmi Note 9S\",\"uuid\":\"a251e653cc3cf96c\"},{\"name\":\"HUAWEI | CMR-W19\",\"uuid\":\"4f6e29ea61d8124b\"}]'\nWHERE id = 1;\n```\n\n<hr>\n","tags":[],"folderPathname":"/Coding","data":{},"createdAt":"2021-03-17T08:15:08.276Z","updatedAt":"2021-09-21T18:21:51.713Z","trashed":false,"_rev":"a9Q4-vbuA"}